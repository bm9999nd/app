import{a as U,b as K,c as G,d as H,e as X}from"./chunk-52OEK4LQ.js";import{h as J,i as W,j as Z,k as Q}from"./chunk-J7HNJTM4.js";import{$ as h,$a as O,Ca as p,Ha as x,Ia as B,Ja as D,Ka as l,La as c,Ma as f,Na as V,O as A,Ra as m,Sa as v,Ta as g,Ua as R,Va as C,W as T,Wa as z,Za as F,_a as b,aa as _,ab as q,c as u,oa as Y,ua as s,va as I,xa as M}from"./chunk-PCLTPDKT.js";var P="gAuth",N=(()=>{let a=class a{constructor(){this.auth=new $,this.authEventName="sheetsAuthorized",this.files={barang:{spreadsheetId:"1uZS1EMtIRsFqxbP7WUIrjYDeB1BSZiELqPYxWa6QCe4",range:"barang!A:S"},barang_trx:{spreadsheetId:"1uZS1EMtIRsFqxbP7WUIrjYDeB1BSZiELqPYxWa6QCe4",range:"transaksi!A:H"}},this.init()}init(){return u(this,null,function*(){document.addEventListener(P,()=>u(this,null,function*(){document.dispatchEvent(new CustomEvent(this.authEventName))})),yield this.auth.init()})}getValues(e,n){return u(this,null,function*(){let t;try{t=yield gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:n})}catch{return null}let i=t.result;return!i||!i.values||i.values.length==0?null:i.values})}valuesToObject(e,n=0){if(e==null)return null;let t=e[n],i=[];return e.forEach((d,k)=>{if(k>n){let y={};d.forEach((S,j)=>{y[t[j]]=S}),i.push(y)}}),i}getMaxId(e,n="id"){if(e==null)return 0;let t=[];return e.filter(d=>!isNaN(d[n])).forEach(d=>t.push(Number(d[n]))),Math.max(...t)}};a.\u0275fac=function(n){return new(n||a)},a.\u0275prov=A({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})(),$=class{constructor(){this.CLIENT_ID="793065333568-iqu12vtn7n0diq9v2ovrdgovhtq8po7i.apps.googleusercontent.com",this.API_KEY="AIzaSyBXsNhV5G4bSq70T-DL4D0TVirV6sC3eBQ",this.DISCOVERY_DOC="https://sheets.googleapis.com/$discovery/rest?version=v4",this.SCOPES="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/spreadsheets.readonly",this.storageName="gToken",this.gapiInited=!1,this.gisInited=!1}init(){return u(this,null,function*(){yield this.gapiLoaded(),yield this.gisLoaded()})}gapiLoaded(){return u(this,null,function*(){return yield gapi.load("client",()=>u(this,null,function*(){try{return yield gapi.client.init({apiKey:this.API_KEY,discoveryDocs:[this.DISCOVERY_DOC]}),this.gapiInited=!0,this.googleEnabled(),console.log("gapi loaded"),!0}catch(a){return console.error(a),!1}}))})}gisLoaded(){return u(this,null,function*(){try{return this.tokenClient=yield google.accounts.oauth2.initTokenClient({client_id:this.CLIENT_ID,scope:this.SCOPES,callback:""}),this.gisInited=!0,this.googleEnabled(),console.log("gis loaded"),!0}catch(a){return console.error(a),!1}})}googleEnabled(){return this.gapiInited&&this.gisInited?(this.auth(),!0):!1}auth(){let a=localStorage.getItem(this.storageName),r=a!=null?JSON.parse(a):null;r!=null&&gapi.client.setToken(r),this.tokenClient.callback=e=>u(this,null,function*(){if(e.error!==void 0)throw e;localStorage.setItem(this.storageName,JSON.stringify(e)),document.dispatchEvent(new CustomEvent(P))}),gapi.client.getToken()===null?this.tokenClient.requestAccessToken({prompt:""}):document.dispatchEvent(new CustomEvent(P))}signOut(){let a=gapi.client.getToken();a!==null&&(google.accounts.oauth2.revoke(a.access_token),gapi.client.setToken(""),localStorage.removeItem(this.storageName))}};function ae(o,a){if(o&1){let r=V();l(0,"li",14),m("click",function(){let t=h(r).$implicit,i=v();return _(i.itemSelected(t))}),g(1),c()}if(o&2){let r=a.$implicit;s(),R(r.nama)}}var w=(()=>{let a=class a{constructor(e){this.sheets=e,this.onScan=!1,this.listItem=[],this.onSelected=new M,this.onDataLoaded=new M}ngOnInit(){return u(this,null,function*(){document.addEventListener(this.sheets.authEventName,()=>u(this,null,function*(){return yield this.loadData()}))})}loadData(){return u(this,null,function*(){let e=this.sheets,n=e.files;yield e.getValues(n.barang.spreadsheetId,n.barang.range).then(t=>{let i=e.valuesToObject(t,0);this.dataBarang=i,this.onDataLoaded.emit(i),console.log("data barang is loaded",i)})})}searchChanged(e){let n=[],i=e.target.value.toLowerCase();i.length>0&&this.dataBarang.forEach(d=>{Object.values(d).filter(S=>S.toLowerCase().includes(i)).length>0&&(n=n.concat(d))}),this.listItem=n}itemSelected(e){this.onSelected.emit(e),this.listItem=[]}};a.\u0275fac=function(n){return new(n||a)(I(N))},a.\u0275cmp=T({type:a,selectors:[["app-scanner"]],outputs:{onSelected:"onSelected",onDataLoaded:"onDataLoaded"},standalone:!0,features:[F],decls:16,vars:4,consts:[["id","search-barang"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-text-left"],[1,"bi","bi-slash"],[1,"bi","bi-upc"],["type","search","placeholder","barcode/nama barang",1,"form-control",3,"disabled","input","change"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"bi","bi-upc-scan"],[1,"list-barang","border","rounded-bottom","p-1",3,"hidden"],[1,"list-group"],[3,"hidden"],[1,"w-100","text-center"],["height","300","width","300",1,"border","rounded","bg-black"],[3,"click"]],template:function(n,t){n&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),f(3,"i",3)(4,"i",4)(5,"i",5),c(),l(6,"input",6),m("input",function(d){return t.searchChanged(d)})("change",function(d){return t.searchChanged(d)}),c(),l(7,"button",7),m("click",function(){return t.onScan=!t.onScan}),f(8,"i",8),c()(),l(9,"div",9)(10,"ul",10),B(11,ae,2,1,"li",null,x),c()()(),l(13,"div",11)(14,"div",12),f(15,"video",13),c()()),n&2&&(s(6),p("disabled",t.dataBarang==null),s(),p("disabled",t.dataBarang==null),s(2),p("hidden",t.listItem.length==0),s(2),D(t.listItem),s(2),p("hidden",!t.onScan))},styles:[".list-barang[_ngcontent-%COMP%]{--bs-bg-opacity: 1;overflow:auto;height:25vh;width:100%;position:absolute;background-color:rgba(var(--bs-tertiary-bg-rgb),var(--bs-bg-opacity));z-index:3}.list-barang[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#dcdcdc;color:#000;font-weight:700;cursor:pointer}"]});let o=a;return o})();var E=o=>({active:o}),ne=o=>[o,"IDR","symbol","0.0","id-ID"];function oe(o,a){if(o&1){let r=V();l(0,"div",7)(1,"div",8),f(2,"img",9),c(),l(3,"div",10)(4,"div",11),g(5),c(),l(6,"div",1)(7,"div",12)(8,"button",13),m("click",function(){let t=h(r).$implicit;return _(t.unit="pcs")}),g(9),c(),l(10,"button",13),m("click",function(){let t=h(r).$implicit;return _(t.unit="pack")}),g(11),c(),l(12,"button",13),m("click",function(){let t=h(r).$implicit;return _(t.unit="dus")}),g(13),c()()(),l(14,"div",1)(15,"div",14)(16,"button",15),m("click",function(){let t=h(r).$implicit,i=v();return _(i.addNumber(t,"-"))}),g(17,"-"),c(),l(18,"div",16),g(19),O(20,"currency"),c(),l(21,"input",17),m("ngModelChange",function(n){let i=h(r).$implicit;return _(i.qty=n)})("input",function(){let t=h(r).$implicit,i=v();return _(i.calculateItem(t))}),c(),l(22,"button",15),m("click",function(){let t=h(r).$implicit,i=v();return _(i.addNumber(t,"+"))}),g(23,"+"),c()()(),l(24,"div",1),g(25),O(26,"currency"),c()()()}if(o&2){let r=a.$implicit,e=v();s(2),p("src",e.getBarang(r).img,Y)("alt",e.getBarang(r).nama),s(3),C(" ",e.getBarang(r).nama," "),s(3),p("ngClass",b(27,E,r.unit=="pcs"))("ngIf",e.getBarang(r).unit_pcs!=""),s(),C(" ",e.getBarang(r).unit_pcs," "),s(),p("ngClass",b(29,E,r.unit=="pack"))("ngIf",e.getBarang(r).unit_pack!=""),s(),C(" ",e.getBarang(r).unit_pack," "),s(),p("ngClass",b(31,E,r.unit=="dus"))("ngIf",e.getBarang(r).unit_dus!=""),s(),C(" ",e.getBarang(r).unit_dus," "),s(6),C(" ",q(20,15,b(33,ne,e.getBarang(r).harga))," x "),s(2),p("ngModel",r.qty),s(4),C(" ",q(26,21,b(35,ne,e.calculateItem(r)))," ")}}var L=function(o){return o.beli="beli",o.jual="jual",o}(L||{}),be=(()=>{let a=class a{constructor(e,n){this.sheets=e,this.item=n,this.kind=L,this.mode=L.jual,this.modal=!1}filteredData(){return this.data}ngOnInit(){return u(this,null,function*(){this.loadData()})}loadData(){return u(this,null,function*(){let e=this.sheets,n=e.files;document.addEventListener(e.authEventName,()=>u(this,null,function*(){yield e.getValues(n.barang_trx.spreadsheetId,n.barang_trx.range).then(t=>{let i=e.valuesToObject(t);this.data=i})}))})}onBarangLoaded(e){this.barang=e}onSelected(e){let t=this.filteredData().find(i=>i.id_barang==e.id);return t==null&&(t={id:this.sheets.getMaxId(this.data,"id")+1,id_barang:e.id,tanggal:new Date,transaksi:this.mode,unit:null,qty:null,jumlah:null,referal:null},this.data.push(t)),t}getBarang(e){let n=this.barang;if(n==null)return console.warn("barang is undefined/null",n),null;let t=n.find(ie=>ie.id==e.id_barang);if(t==null)return console.warn("filtered data is undefined/null",e,t),null;let i=e.mode,d=e.unit,k=t[`beli_${d}`],y=t[`jual_${d}`],S=t[`unit_${d}`],j=i==L.beli?k:y;return t.unitRender=S,t.hargaBeli=k,t.hargaJual=y,t.harga=j,t}addNumber(e,n){n=="+"?e.qty=Number(e.qty)+1:n=="-"&&(e.qty=Number(e.qty)-1),this.calculateItem(e)}calculateItem(e){let n=this.getBarang(e);return e.jumlah=n.harga*e.qty,e.jumlah}};a.\u0275fac=function(n){return new(n||a)(I(N),I(w))},a.\u0275cmp=T({type:a,selectors:[["app-barang-transaksi"]],standalone:!0,features:[z([{provide:w}]),F],decls:11,vars:8,consts:[[3,"onSelected","onDataLoaded"],[1,"d-block","mb-3"],[1,"btn-group","w-100"],["type","button",1,"btn","btn-outline-primary",3,"ngClass","click"],["type","button",1,"btn","btn-outline-warning",3,"ngClass","click"],[1,"d-block",3,"hidden"],[3,"hidden"],[1,"row","mb-3"],[1,"col-auto","d-grid","align-items-center"],[1,"img-item","border","rounded",3,"src","alt"],[1,"col"],[1,"d-block","fs-3"],[1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"ngClass","ngIf","click"],[1,"input-group"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"input-group-text"],["type","number","placeholder","qty",1,"form-control",3,"ngModel","ngModelChange","input"],["class","row mb-3"]],template:function(n,t){n&1&&(l(0,"app-scanner",0),m("onSelected",function(d){return t.onSelected(d)})("onDataLoaded",function(d){return t.onBarangLoaded(d)}),c(),l(1,"div",1)(2,"div",2)(3,"button",3),m("click",function(){return t.mode=t.kind.jual}),g(4," Penjualan "),c(),l(5,"button",4),m("click",function(){return t.mode=t.kind.beli}),g(6," Pembelian "),c()()(),l(7,"div",5),B(8,oe,27,37,"div",18,x),c(),f(10,"div",6)),n&2&&(s(3),p("ngClass",b(4,E,t.mode==t.kind.jual)),s(2),p("ngClass",b(6,E,t.mode==t.kind.beli)),s(2),p("hidden",t.modal),s(),D(t.filteredData()),s(2),p("hidden",!t.modal))},dependencies:[Q,J,W,Z,X,U,H,K,G,w],styles:[".img-item[_ngcontent-%COMP%]{width:100px;height:100px;display:block}"]});let o=a;return o})();export{be as BarangTransaksiComponent};
